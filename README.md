# XYZ Supplier Discount

افزودن فیلد «درصد تخفیف تامین‌کننده» به محصولات ووکامرس و اعمال تخفیف فقط برای کاربران با نقش `supplier`.

## نصب

1. فولدر `xyz-supplier-discount` را در مسیر `wp-content/plugins/` قرار دهید.
2. فایل `xyz-supplier-discount.php` را داخل این فولدر بگذارید.
3. از داخل پیشخوان وردپرس، بخش افزونه‌ها، افزونه **XYZ Supplier Discount** را فعال کنید.
4. مطمئن شوید ووکامرس فعال است.
5. نقش کاربری `supplier` را در سایت خود دارید (یا بسازید).

## نحوه استفاده

- در صفحه ویرایش محصول ساده:
    - در تب **General** یک فیلد جدید با عنوان «درصد تخفیف تامین‌کننده» می‌بینید.
    - عددی بین ۰ تا ۱۰۰ وارد کنید. این عدد درصد تخفیف برای نقش `supplier` است.
- در محصولات متغیر:
    - برای هر variation یک فیلد «درصد تخفیف تامین‌کننده» نمایش داده می‌شود.
    - اگر برای variation مقدار تنظیم نشود، مقدار والد محصول (اگر وجود داشته باشد) استفاده می‌شود.

## رفتار در Front-End

- اگر کاربر وارد شده با نقش `supplier` باشد:
    - قیمت محصول با اعمال درصد تخفیف نمایش داده می‌شود.
- سایر نقش‌ها:
    - هیچ تغییری در قیمت‌ها نمی‌بینند.

## Hook های اصلی و دلیل انتخاب

- `woocommerce_product_options_pricing`:
    - برای افزودن فیلد سفارشی در بخش قیمت محصولات ساده
- `woocommerce_admin_process_product_object`:
    - برای ذخیره امن متا در زمان ذخیره محصول
- `woocommerce_product_after_variable_attributes`:
    - برای نمایش فیلد سفارشی در هر variation در صفحه ویرایش محصول متغیر.
- `woocommerce_save_product_variation`:
    - ذخیره متای variation ها برای وقتی که آن ها ذخیره شده اند
- `woocommerce_product_get_price` و `woocommerce_product_variation_get_price`:
    - برای تغییر قیمت نهایی نمایش داده شده در فرانت‌اند (اعمال تخفیف برای role خاص).
- `woocommerce_available_variation`
  - برای اپدیت کردن نمایش قیمت محصول در زمانی که یکی از variation ها انتخاب میشود
- کنترل نقش‌ها با `wp_get_current_user` و چک `supplier`:
    - برای جلوگیری از تاثیر روی نقش‌های دیگر.

## تست نمونه

1. یک محصول ساده با قیمت 100000 بسازید.
2. فیلد درصد تخفیف تامین‌کننده را برابر 20 قرار دهید.
3. با کاربر دارای نقش `supplier` وارد شوید.
4. در صفحه محصول، قیمت باید 80000 نمایش داده شود.
5. با یک کاربر عادی (مثلاً customer) قیمت همان 100000 خواهد بود.
